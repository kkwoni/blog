---
layout: post
title: "android - android에서 javacv 사용하기 porting"
date: 2011-06-04 12:00:03
comments: false
categories: old blog
---

놀러가기 좋고 맑고 화창한 생일에 우울하게 이런걸 작성하고 있다니ㅋㅋ  
그래도 물어보는 사람이 있어서 이 기회에 정리..  
구글 코드에 javacv 페이지가 있습니다  
[http://code.google.com/p/javacv/][link1]  

[link1]: http://code.google.com/p/javacv/

![](http://cythumb.cyworld.com/639x0/c2down.cyworld.co.kr/download?fid=64222f299e835976ec1230586a74ae98&name=1.jpg)
![](http://cythumb.cyworld.com/639x0/c2down.cyworld.co.kr/download?fid=64222f299e83597628bb30586d84ce98&name=1_00000.jpg)

다운로드 들어가서 javacv bin 과 opencv2.2 android arm 을 다운로드해서 압축을 풉니다  
javacv bin에서 쓰이는 파일은 다음 3가지 입니다  
javacv-android-arm.jar 압축을 풀어줍니다  
![](http://cythumb.cyworld.com/639x0/c2down.cyworld.co.kr/download?fid=64222f299e8359766526305871860898&name=1_00001.jpg)

예제로 이미지를 불러와 흑백으로 저장하는 것을 해보겠습니다.
안드로이드 프로젝트를 하나 만듭니다.저는 JavacvTest라고 만들었습니다.
프로젝트에 libs 폴더를 만들고 안에 armeabi 폴더를 또 만들어줍니다.  
javacpp.jar와 javacv.jar는 libs에 복사해주시고 두 파일을 build path를 걸어줍니다.
압축을 푼 javacv-android-arm 폴더를 쮹 들어가보시면 jni가 있습니다.  
간단한 예제이므로 3가지 파일만 쓰겠습니다.
libjniopencv_core.so / libjniopencv_highgui.so/libjniopencv_imgproc.so를 프로젝트의 armeabi에 복사를 합니다.
다음 처음에 풀었던 OpenCV-2.2.0-android-arm 폴더를 보시면 libs>armeabi에 opencv so파일들이 있습니다.
libopencv_core.so / libopencv_highgui.so/libopencv_imgproc.so를 복사해서 프로젝트의 armeabi에 복사를 합니다.   
![](http://cythumb.cyworld.com/639x0/c2down.cyworld.co.kr/download?fid=64222f299e8359769ec43058803c9098&name=1_00003.jpg)

이렇게 하면 라이브러리 준비는 끝..  

//main.xml
{% highlight ruby %}
<?xml version="1.0" encoding="utf-8"?><LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
 android:orientation="vertical"
 android:layout_width="fill_parent"
 android:layout_height="fill_parent"
><TextView 
 android:layout_width="fill_parent" 
 android:layout_height="wrap_content" 
 android:text="@string/hello"
 /><Button
 android:id="@+id/button"
 android:layout_width="wrap_content"
 android:layout_height="wrap_content"
/><ImageView
 android:id="@+id/image"
 android:layout_width="wrap_content"
 android:layout_height="wrap_content"
/></LinearLayout> 
{% endhighlight %}

//JavacvTest.java
{% highlight ruby %}
package com.JavacvTest;

//import가 자동으로 안뜨는 경우 일일이 다 찾아서 타이핑 해주셔야해요 
import com.googlecode.javacv.cpp.opencv_core.IplImage;
import static com.googlecode.javacv.cpp.opencv_highgui.CV_LOAD_IMAGE_GRAYSCALE;
import static com.googlecode.javacv.cpp.opencv_highgui.cvLoadImage;
import static com.googlecode.javacv.cpp.opencv_highgui.cvSaveImage;
import static com.googlecode.javacv.cpp.opencv_core.cvReleaseImage; 
import android.app.Activity;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;

public class JavacvTest extends Activity {
    ImageView imageview;
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
        imageview = (ImageView) findViewById(R.id.image);
        Bitmap bitmap = BitmapFactory.decodeFile("/sdcard/1.jpg");
        imageview.setImageBitmap(bitmap);
        Button button = (Button) findViewById(R.id.button);
        button.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                IplImage srcImage = cvLoadImage("/sdcard/1.jpg", CV_LOAD_IMAGE_GRAYSCALE);
                cvSaveImage("/sdcard/2.jpg", srcImage);
                cvReleaseImage(srcImage);
                Bitmap bitmap = BitmapFactory.decodeFile("/sdcard/2.jpg");
                imageview.setImageBitmap(bitmap);
            }
        });
    }
}
{% endhighlight %}

매니패스트에 퍼미션 추가 해주세요  
{% highlight ruby %}
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
{% endhighlight %}

run하면 

![](http://cythumb.cyworld.com/639x0/c2down.cyworld.co.kr/download?fid=64222f299e835976eea1305885857c98&name=device.jpg)

실행

![](http://cythumb.cyworld.com/639x0/c2down.cyworld.co.kr/download?fid=64222f299e83597638b8305885853598&name=device1.jpg)
